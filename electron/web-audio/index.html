HELLO!!

<html>
    <script src="../node_modules/webix/webix.js"></script>

    <link rel="stylesheet" href="../node_modules/webix/webix.css">
    <link rel="stylesheet" href="../node_modules/webix/skins/terrace.css">
    <link rel="stylesheet" href="../node_modules/webix/skins/contrast.css">
    <link rel="stylesheet" href="../pydjay_ui/pymusic_style.css">
        
    <!-- <div id="waveform"></div>

    <div id="waveform-preview"></div> -->
    <script src="http://cdnjs.cloudflare.com/ajax/libs/wavesurfer.js/2.0.6/wavesurfer.min.js"></script>
    <script src="event_dispatcher.js"></script>
    <script src="audio_context.js"></script>
    <script src="audio_player.js"></script>
    <script type="text/javascript">
        var player = new PydjayAudioPlayer()
        player.connectOutputs({master:{left:2, right:3}, monitor:{left:4, right:5}})
        //player.on("stream-position", console.log)
        player.on("end-of-stream", () => console.log("eos"))
        var cue_player = new PydjayAudioPlayer()
        cue_player.audio_context.connectOutputs({master:{left:4, right:5}})
        foo = webix.ui({
            rows: [
                {
                    height:100,
                    view:"template",
                    template:'<div id="waveform"></div>'
                },
                {
                    cols: [
                        {},
                        {
                            view: "button",
                            label: "PLAY", 
                            click: function () {
                                player.play("track_4.mp3", 0, 47000)
                            }
                        },
                        {},
                        {
                            view: "button",
                            label: "PLAY/PAUSE", 
                            click: function () {
                                player.togglePause()
                            }
                        },
                        {},
                        {
                            view: "button",
                            label: "PAUSE", 
                            click: function () {
                                player.pause()
                            }
                        },
                        {},
                        {
                            view: "button",
                            label: "STOP", 
                            click: function () {
                                player.stop()
                            }
                        },
                        {},
                        {
                            view: "button",
                            label: "Switch", 
                            click: function () {
                                player.connectOutputs({master: {left:1, right:0}})
                            }
                        },
                        {}
                    ]
                },
                {
                    height:100,
                    view:"template",
                    template:'<div id="waveform-preview"></div>'
                },
                {
                    cols: [
                        {},
                        {
                            view: "button",
                            label: "PLAY", 
                            click: function () {
                                cue_player.play("track_4.mp3")
                            }
                        },
                        {}
                    ]
                },

            ]
        })



        // var main_context = new MainDeckAudioContext()
        // var pre_context = new PreviewDeckAudioContext()
        var wavesurfer = WaveSurfer.create({
            container: '#waveform',
            pixelRatio: 1,
            scrollParent: true,
            hideScrollbar: true,
            //audioContext:main_context
        });
        var wavesurfer2 = WaveSurfer.create({
            container: '#waveform-preview',
            scrollParent: true,
            hideScrollbar: true,
            // waveColor: "purple",
            // progressColor: "blue",
            //audioContext:preview_context
        });
        wavesurfer.on("ready", function () {
            console.log("ready")
        })
        // wavesurfer.load('track_1.mp3');

        wavesurfer2.on("ready", function () {
            console.log("ready")
        })




        // class PydjayMainAudioContext extends PydjayAudioContext {
        //     constructor(channel_layout) {
        //         super()
        //         console.log(channel_layout)
        //         if (channel_layout.master != undefined){
        //             this.splitter.connect(this.gain_controls[channel_layout.master.left], 0, 0)
        //             this.splitter.connect(this.gain_controls[channel_layout.master.right], 1, 0)
        //         }
        //         if (channel_layout.monitor != undefined) {
        //             this.splitter.connect(this.gain_controls[channel_layout.monitor.left], 0, 0)
        //             this.splitter.connect(this.gain_controls[channel_layout.monitor.right], 1, 0)
        //         }
        //     }
        // }


        // function MainDeckAudioContext() {
        //     var self = this;
        //     this.audio_ctx =  new PydjayAudioContext()
        //     this.audio_ctx.connectOutputs({master: {left:0, right:1}}) //, monitor: {left:4, right:5}})
        //     this.source = null;

        //     this.play = function (buffer, start, end) {
        //         self.stop()
        //         self.source = self.audio_ctx.audio_ctx.createBufferSource()
        //         self.source.buffer = buffer //(wavesurfer.backend.buffer)
        //         self.source.channelCount = 2
        //         self.source.channelInterpretation = "speakers"
        //         self.source.connect(self.audio_ctx.splitter)
        //         if ((start != undefined) && (end != undefined)) {
        //             self.source.start(0, start, end - start)
        //         } else if (start != undefined) {
        //             self.source.start(0, start)
        //         } else {
        //             self.source.start(0, start)
        //         }
        //     }

        //     this.stop = function () {
        //         (self.source != null) && self.source.stop()
        //         self.source = null
        //     }

        //     // this.set_monitor_volume = function (volume) {
        //     //     self.duck_under_1.gain.linearRampToValueAtTime(volume, self.audio_ctx.currentTime + 0.75)
        //     //     self.duck_under_2.gain.linearRampToValueAtTime(volume, self.audio_ctx.currentTime + 0.75)
        //     // }

        //     // this.duck_monitor = function () {
        //     //     self.set_monitor_volume(0.001)
        //     // }

        //     // this.restore_monitor = function () {
        //     //     self.set_monitor_volume(1)
        //     // }

        // }

        // function PreviewDeckAudioContext() {
        //     var self = this;
        //     this.audio_ctx =  new AudioContext()
        //     this.audio_ctx.destination.channelCount = this.audio_ctx.destination.maxChannelCount
        //     this.audio_ctx.destination.channelInterpretation = "discrete"
        //     this.splitter =  this.audio_ctx.createChannelSplitter(this.audio_ctx.destination.maxChannelCount)
        //     this.splitter.channelInterpretation = "discrete"
        //     this.splitter.channelCount = this.audio_ctx.destination.maxChannelCount
        //     this.merger = this.audio_ctx.createChannelMerger(this.audio_ctx.destination.maxChannelCount)
        //     this.merger.channelCount = this.audio_ctx.destination.maxChannelCount
        //     this.merger.channelInterpretation = "discrete"
        //     this.splitter.connect(this.merger, 0, 0)
        //     this.splitter.connect(this.merger, 1, 1)
        //     this.merger.connect(this.audio_ctx.destination)

        //     this.play = function (buffer, start, end) {
        //         self.stop()
        //         self.source = self.audio_ctx.createBufferSource()
        //         self.source.buffer = buffer //(wavesurfer.backend.buffer)
        //         self.source.channelInterpretation = "discrete"
        //         self.source.connect(self.splitter)
        //         if ((start != undefined) && (end != undefined)) {
        //             self.source.start(0, start, end - start)
        //         } else if (start != undefined) {
        //             self.source.start(0, start)
        //         } else {
        //             self.source.start(0, start)
        //         }
        //     }

        //     this.pause = function () {

        //     }

        //     this.stop = function () {
        //         (self.source != null) && self.source.stop()
        //         self.source = null
        //     }

        //     this.playUrl = function (url) {
        //         self.source = new Audio()
        //         self.source.src = url
        //         //let ctx = new AudioContext()
        //         let x = self.audio_ctx.createMediaElementSource(self.source)
        //         x.channelInterpretation = "discrete"
        //         x.connect(self.splitter)
        //         self.source.play()
        //         console.log(self.source)
        //         //let y = self.audio_ctx.createGain()
        //         //y.gain.linearRampToValueAtTime(10, 2)
        //         //let t = x.connect(y).connect(ctx.destination)
        //     } 
        // }



        //wavesurfer2.load('track_2.mp3');
        //main_context.source.start()
        //wavesurfer.backend.ac.destination.addEventListener("audioprocess", () => {console.log("x")})
    </script>
</html>
