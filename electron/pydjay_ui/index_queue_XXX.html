<!DOCTYPE html>
<title>PYMUSIC DJ App</title>
<script src="../node_modules/semantic-ui/dist/semantic.min.js"></script>
<script src="../node_modules/webix/webix.js"></script>
<script src="../lib/utils.js"></script>
<script src="../lib/queue_display.js"></script>
<link rel="stylesheet" href="../node_modules/webix/webix.css">
<link rel="stylesheet" href="../node_modules/semantic-ui/dist/semantic.min.css">

<body>
  <article id="mainArticle">
  </article>
</body>
<script type="text/javascript">



// function queue_element_template(element) {
//     var cover_source = null;
//     if (element.cover == null) {
//         cover_source = "../resources/images/default_album_cover.png"
//     } else {
//         cover_source = `${element.image_root}/${element.cover}`
//     }
//     return `<img class="ui left floated image"  style="float:left; width:auto;" src="${cover_source}" height='75' width='75'></img>
//                 <div style="float:left; width:200px">
//                     <div style="height:20px; white-space:nowrap; overflow: hidden; text-overflow: ellipsis;"><b>${element.title}</b></div>
//                     <div style="height:20px; white-space:nowrap; overflow: hidden; text-overflow: 'ellipsis'"><i>${element.artist}</i></div>
//                     <div style="width:85px; height:20px">${element.bpm} BPM</div>
//                 </div>
//                 <div class="ui grey label" style="float:right; font-size:12px; flex-grow:0; position:relative; top:50%; transform: translateY(-50%)">
//                     ${format_nanoseconds(element.stream_length)}
//                 </div>`
// }
queue_display_template.container = 'mainArticle';
var datatable = webix.ui(queue_display_template)
//     {
//     container:"mainArticle",
//     rows:[
//         {height:7},
//         {
//             rows: [
//                 {
//                     view: 'label',
//                     label: '<b>QUEUE</b>',
//                     height: 20
//                 },
//                 {
//                     cols:[
//                     {
//                         view: 'label',
//                         label: 'Duration:',
//                         height: 20
//                     },
//                     {
//                         view: 'label',
//                         css: {'text-align':'right'},
//                         label: 'Ends at:',
//                         height: 20
//                     }
//                     ]
//                 }
//             ]
//         },
//         {height:3},
//         {
//             view:"list",
//             id:'queue_list',
//             itemHeight:40,
//             css:{height:"1000px"},
//             template: queue_element_template,
//             type: { height: 75  },
//         }]
// });

var mysql = require('mysql');

var db_connection = mysql.createConnection({
  host: "localhost",
  user: "root",
  password: "root",
  database:'pymusic'
});

db_connection.connect(
  function(err) {
    if (err) throw err;
    console.log("Connected!");
});

$$('queue_list').clearAll()

//var sql = "SELECT title, artist, album, date_added, last_played, rating, bpm, stream_length FROM tracks LIMIT 200";
//var sql = "SELECT tracks.title, tracks.artist, tracks.album, tracks.bpm, tracks.stream_length, settings.db_image_cache as image_root, tracks.cover_small as cover FROM tracks  LEFT JOIN settings ON 1"
var sql = `SELECT session_queue.position, tracks.title, tracks.artist,
                  tracks.album, tracks.bpm, tracks.stream_length,
                  settings.db_image_cache as image_root, tracks.cover_small as cover
           FROM
               (tracks LEFT JOIN settings ON 1) LEFT JOIN session_queue
           ON
               tracks.id=session_queue.track_id WHERE session_queue.status='pending'
           ORDER BY position`

db_connection.query(sql, function (err, result) {
    if (err) throw err;
    for(var i=0; i < result.length; i++){
        //console.log(result[i].cover);
        //console.log(result[i].image_root);
        $$('queue_list').add(result[i])
    }
  });


</script>
