<!DOCTYPE html>
<title>PYMUSIC DJ App</title>
<script src="../node_modules/semantic-ui/dist/semantic.min.js"></script>
<script src="../node_modules/webix/webix.js"></script>
<link rel="stylesheet" href="../node_modules/webix/webix.css">
<link rel="stylesheet" href="../node_modules/semantic-ui/dist/semantic.min.css">

<body>
  <header id="pageHeader">Header</header>
  <article id="mainArticle">
  </article>
  <footer id="pageFooter" onClick="function(x) {
                            datatable.data = { id:1, title:'TTTThe Shawshank Redemption', year:1994, votes:678790, rank:1},
  { id:2, title:'The Godfather', year:1972, votes:511495, rank:2}}">Footer</footer>
</body>
<script type="text/javascript">

function format_nanoseconds (ts) {
    var sec_num = Math.round(ts / 1000000000);
    var hours   = Math.floor(sec_num / 3600);
    var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
    var seconds = sec_num - (hours * 3600) - (minutes * 60);

    if (hours   < 10) {hours   = "0"+hours;}
    if (minutes < 10) {minutes = "0"+minutes;}
    if (seconds < 10) {seconds = "0"+seconds;}

    if (hours == 0){
        return minutes+':'+seconds;
    }
    return hours+':'+minutes+':'+seconds;
}

function custom_checkbox(obj, common, value){
    if (value)
        return "<div class='webix_table_checkbox checked'><img src='../resources/images/love-focus.png' height='13'> </div>";
    else
        return "<div class='webix_table_checkbox notchecked'><img src='../resources/images/love.png' height='13'> </div>";
};

function queue_element_template(element) {
    var cover_source = null;
    //concole.log(element.cover)
    if (element.cover == null) {
        cover_source = "../resources/images/default_album_cover.png"
    } else {
        cover_source = `${element.image_root}/${element.cover}`
    }
    return `<div><img class="ui left floated image" src="${cover_source}" height='64' width='64'></img><div class="left floated content">${element.title} --- ${element.artist}</div><div class="right floated content"><div class="ui label"><i class="mail icon"></i> 23</div></div></div>`
}

var datatable = webix.ui({
    container:"mainArticle",
    view:"list",
    //select:"row",
    //resizeColumn:{headerOnly:true},
    itemHeight:40,
    //height:"100%",
    css:{height:"1000px"},
    template: queue_element_template, //"<div><img src='#image_root#/#cover#' height='64px' width='64px'></img>#title# - #artist#",
    type: { height: 70  },
    columns:[
        // { id:"id",            header:"",  width:30, template:"<img src='../resources/images/precue.png' style='filter: invert(1);' height='20'>", checkValue:1, uncheckValue:0},
        { id:"favorite",      header:{text:"", height:20},  width:30, template:custom_checkbox, checkValue:1, uncheckValue:0, sort:'int'},
        // { id:"enabled",       header:"",  width:30, template:"{common.checkbox()}", checkValue:0, uncheckValue:1, sort:'int'},
        { id:"title",         header:"<b>Title</b>",  fillspace:true, sort:'string'},
        { id:"artist",        header:"<b>Artist</b>", fillspace:true, sort:'string'},
        { id:"album",         header:"<b>Album</b>",  fillspace:true, sort:'string'},
        { id:"genre",         header:"<b>Genre</b>",  width:150, sort:'string'},
        //{ id:"date_added",    header:{text:"<b>Added</b>", css:{"text-align":'center'}},   format:webix.Date.dateToStr("%Y-%m-%d"), css:{"text-align":'right'}, sort:'date'},
        //{ id:"date_modified", header:{text:"<b>Modified</b>", css:{"text-align":'center'}},   format:webix.Date.dateToStr("%Y-%m-%d"), css:{"text-align":'right'}, sort:'date'},
        { id:"play_count",    header:{text:"<b>Plays</b>", css:{"text-align":'center'}},  width:50,     template:"<div class='ui right floated label' style='text-align: right'>#play_count#</div>", sort:'int'},
        //{ id:"last_played",   header:{text:"<b>Last Played</b>", css:{"text-align":'center'}},     format:webix.Date.dateToStr("%Y-%m-%d"), css:{"text-align":'right'}, header_css:{"text-align":'right'}, sort:'date'},
        { id:"rating",        header:{text:"<b>Rating</b>", css:{"text-align":'center'}}, width:75,  template:"<img src='../resources/images/rating#rating#.png' style='filter: invert(1);' height='10'>", css:{"text-align":'right'}, sort:'int'},
        { id:"bpm",           header:{text:"<b>BPM</b>", css:{"text-align":'center'}},    width:50,     css:{"text-align":'right'}, sort:'int'},
        { id:"stream_length",      header:{text:"<b>Length</b>", css:{"text-align":'center'}},   width:75,       format:format_nanoseconds, css:{"text-align":'right'}},
    ],
});

var mysql = require('mysql');

var db_connection = mysql.createConnection({
  host: "localhost",
  user: "root",
  password: "root",
  database:'pymusic'
});

db_connection.connect(
  function(err) {
    if (err) throw err;
    console.log("Connected!");
});

datatable.clearAll()

var sql = "SELECT title, artist, album, date_added, last_played, rating, bpm, stream_length FROM tracks LIMIT 200";
var sql = "SELECT tracks.title, tracks.artist, tracks.album, tracks.bpm, tracks.stream_length, settings.db_image_cache as image_root, tracks.cover_small as cover FROM tracks  LEFT JOIN settings ON 1 LIMIT 20"
db_connection.query(sql, function (err, result) {
    if (err) throw err;
    for(var i=0; i < result.length; i++){
        datatable.add(result[i])
    }
  });


</script>
