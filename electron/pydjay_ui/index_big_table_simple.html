<!DOCTYPE html>
<title>PYMUSIC DJ App</title>
<script src="../node_modules/semantic-ui/dist/semantic.min.js"></script>
<script src="../node_modules/webix/webix.js"></script>
<script src="../lib/utils.js"></script>
<script src="../lib/main_list_display.js"></script>
<link rel="stylesheet" href="../node_modules/webix/webix.css">
<link rel="stylesheet" href="../node_modules/semantic-ui/dist/semantic.min.css">

<body>
  <article id="mainArticle">
  </article>
</body>
<script type="text/javascript">

// function format_nanoseconds (ts) {
//     var sec_num = Math.round(ts / 1000000000);
//     var hours   = Math.floor(sec_num / 3600);
//     var minutes = Math.floor((sec_num - (hours * 3600)) / 60);
//     var seconds = sec_num - (hours * 3600) - (minutes * 60);
//
//     if (hours   < 10) {hours   = "0"+hours;}
//     if (minutes < 10) {minutes = "0"+minutes;}
//     if (seconds < 10) {seconds = "0"+seconds;}
//
//     if (hours == 0){
//         return minutes+':'+seconds;
//     }
//     return hours+':'+minutes+':'+seconds;
// }

// function custom_checkbox(obj, common, value){
//     if (value)
//         return "<div class='webix_table_checkbox checked'><img src='../resources/images/love-focus.png' height='13'> </div>";
//     else
//         return "<div class='webix_table_checkbox notchecked'><img src='../resources/images/love.png' height='13'> </div>";
// };

var datatable = webix.ui(main_list_display_template);
//     {
//     container:"mainArticle",
//     rows:
//     [
//         {height:7},
//         {
//             cols: [
//                 {
//                     rows:[
//                     {
//                         view: 'label',
//                         label: '<b>ALL SONGS</b>',
//                         height: 20
//                     },
//                     {
//                         view: 'label',
//                         css: {'text-align':'left'},
//                         label: 'Ends at:',
//                         height: 20
//                     }
//                     ]
//                 },
//                 {
//                     view: 'text'
//                 },
//                 {width:10}
//             ]
//         },
//         {height:5},
//         {
//             view:"datatable",
//             id:"display_list",
//             select:"row",
//             resizeColumn:{headerOnly:true},
//             css:{height:"1000px"},
//             columns:[
//                 { id:"id",            header:"",  width:30, hidden:true, template:"<img src='../resources/images/precue.png' style='filter: invert(1);' height='20'>", checkValue:1, uncheckValue:0},
//                 { id:"favorite",      header:{text:"", height:25},  width:30, template:custom_checkbox, checkValue:1, uncheckValue:0, sort:'int'},
//                 { id:"title",         header:"<b>Title</b>",  fillspace:true, sort:'string'},
//                 { id:"artist",        header:"<b>Artist</b>", fillspace:true, sort:'string'},
//                 { id:"album",         header:"<b>Album</b>",  fillspace:true, sort:'string'},
//                 { id:"genre",         header:"<b>Genre</b>",  width:150, sort:'string'},
//                 { id:"play_count",    header:{text:"<b>Plays</b>", css:{"text-align":'center'}},  width:50,     template:"<div class='ui right floated label' style='text-align: right'>#play_count#</div>", sort:'int'},
//                 { id:"rating",        header:{text:"<b>Rating</b>", css:{"text-align":'center'}}, width:75,  template:"<img src='../resources/images/rating#rating#.png' style='filter: invert(1);' height='10'>", css:{"text-align":'right'}, sort:'int'},
//                 { id:"bpm",           header:{text:"<b>BPM</b>", css:{"text-align":'center'}},    width:50,     css:{"text-align":'right'}, sort:'int'},
//                 { id:"stream_length",      header:{text:"<b>Length</b>", css:{"text-align":'center'}},   width:75,       format:format_nanoseconds, css:{"text-align":'right'}},
//             ]}
//     ]
// });

var mysql = require('mysql');

var db_connection = mysql.createConnection({
  host: "localhost",
  user: "root",
  password: "root",
  database:'pymusic'
});

db_connection.connect(
  function(err) {
    if (err) throw err;
    console.log("Connected!");
});

$$('display_list').clearAll()

var sql = "SELECT title, artist, album, date_added, last_played, rating, bpm, stream_length FROM tracks LIMIT 200";
var sql = "SELECT id, favorite, disabled as enabled, title, artist, album, genre, date_added, date_modified, rating, bpm, stream_length, max(session_tracks.start_time) as last_played, count(session_tracks.track_id) as play_count FROM tracks LEFT JOIN session_tracks ON tracks.id = session_tracks.track_id GROUP BY id"
db_connection.query(sql, function (err, result) {
    if (err) throw err;
    for(var i=0; i < result.length; i++){
        $$('display_list').add(result[i])
    }
  });


</script>
