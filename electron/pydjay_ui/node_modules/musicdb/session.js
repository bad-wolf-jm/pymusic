const { TrackListController } = require("./object_list.js")


class SessionController extends TrackListController {
    constructor(db, collection, id) {
        super(db, collection, id)
    }

    async getAll() {
        let q = await this.getList()
        let tracks = await this.d.getTracksByIds(q.map((x) => {return x.track_id}))
        let x = {}
        // console.log(q, tracks)
        tracks.forEach((t) => {x[t._id] = t})
        return q.map((t) => {return x[t.track_id]})
    }

    async length() {
        let q = await this.getList()
        let i = q.indexOf(null)
        return (i == -1) ? q.length : i 
    }

    async duration() {
        let q = await this.getList()
        return this.d.duration(q.slice(0, this.length())) 
    }

    getId(id) {
        return this.d.getTrackById(id)
    }
}

module.exports = {
    SessionController: SessionController
}