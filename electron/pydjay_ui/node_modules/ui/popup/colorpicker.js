const {Bubble} = require("ui/popup/bubble.js")
const {DismissButton} = require("ui/dialog/buttons.js")
const {DOMElement} = require("ui/dom/domelement.js")

class ColorPicker extends Bubble {
    constructor(parent_element, config) {
        super(parent_element)
        this.configuration = config

        this.color_palette = new DOMElement("table")
        this.color_palette.setStyle({
            margin:"10px"
        })

        let palette = [
            "#ff3855", "#fd3a4a", "#fb4d46", "#fa5b3d", "#ffaa1d", "#fff700", "#299617", "#a7f432", 
            "#2243b6", "#5dadec", "#5946b2", "#9c51b6", "#a83731", "#af6e4d", "#1b1b1b", "#bfafb2", 
            "#ff5470", "#ffbd00", "#ff7a00", "#fdff00", "#87ff2a", "#0048ba", "#ff007c", "#e936a7"]

        for (let i=0; i<3; i++) {
            let row = new DOMElement("tr")
            row.setStyle({height:"10px"})
            this.color_palette.appendChild(row)
            for(let j=0; j<8; j++) {
                let cell = new DOMElement("td")
                let swatch = new DOMElement("div")
                swatch.setStyle({
                    height:"22px",
                    width:"22px",
                    borderRadius:"5px",
                    backgroundColor:palette[i*8+j]
                })
                cell.appendChild(swatch)
                row.appendChild(cell)
                cell.domElement.addEventListener("click", (e) => {
                    if (this.configuration.chooseColor != undefined) {
                        this.configuration.chooseColor(palette[i*8+j])
                        e.stopPropagation()
                    }        
                })
            }
        }

        this.remove_color_button = new DismissButton()
        this.remove_color_button.setText("Remove color")
        this.remove_color_button.on("click", () => {
            if (this.configuration.chooseColor != undefined) {
                this.configuration.chooseColor(null)
                //e.stopPropagation()
            }
        })

        this.appendChildren([this.color_palette, this.remove_color_button])
        this.setStyle({width:'230px', height:'150px'})

    }
}

module.exports = {
    ColorPicker: ColorPicker
}