const Clusterize = require("clusterize.js")
const { BaseListView } = require("./base")

class ClusteredListView extends BaseListView {
    constructor(element, list_scroller) {
        super(element, list_scroller)
        this._cluster = new Clusterize({
            rows: [],
            scrollElem: this.scrollerElement,
            contentElem: this.domElement,
            callbacks: {
                clusterWillChange: () => {
                    this._row_elements.clear()
                },
                clusterChanged: () => {
                    let elements = document.querySelectorAll(`.${this._viewId}`);
                    this.setRowElements(elements)
                    this.setDimmedRows(this._dimmed.getElementIds())
                    this.clusterChanged(elements)
                },
                scrollingProgress: (progress) => {

                }
            }
        });
    }

    setRows(elems) {
        let x = super.setRows(elems)
        this._cluster.update(this._rendered_rows.getList())
        return x
    }

    clusterChanged(rows) {

    }
}

module.exports = {
    ClusteredListView: ClusteredListView
}