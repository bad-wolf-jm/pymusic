const {AudioTrackPlayer} = require('track_playback/track_player.js')


mpl_channel_config = {master:{left:4, right:5}, headphones:{left:0, right:1}}
mpl_channel_config2 = {master:{left:0, right:1}}


class PlaybackController extends AudioTrackPlayer {
    constructor() {
        super()
        this.playing            = false

        this.monitor_set_volume = 1;
        this.monitor_volume = 1;
        this.monitor_muted_volume = 0;


        this.on('end-of-stream', () => {
            ipcRenderer.sendTo(parentId, `${response_prefix}end-of-stream`, {})
        })

        this.on('playback-stopped',  () => {
            ipcRenderer.sendTo(parentId, `${response_prefix}playback-stopped`, {})
        })
    
        this.on('playback-paused', () => {
            ipcRenderer.sendTo(parentId, `${response_prefix}playback-paused`, {})
        })
        
        this.on('playback-started', () => {
            ipcRenderer.sendTo(parentId, `${response_prefix}playback-started`, {})
        })

        this.on('stream-position', (pos) => {
            ipcRenderer.sendTo(parentId, `${response_prefix}stream-position`, {
                position: pos, 
                duration:this.source.duration
            })
        })
    }

    mute_monitor() {
        var a_monitor_volume = {volume: this.monitor_volume};
        $(a_monitor_volume).animate(
            {volume: this.monitor_muted_volume},
            {
                duration:100,
                step: (now, tween) => {
                    this.set_monitor_volume(now);
                },
            }
        )
    }

    set_monitor_volume(value) {
        this.setVolume('headphones', 'left', value)
        this.setVolume('headphones', 'right', value)
    }

        
    restore_monitor() {
        var a_monitor_volume = {volume: this.monitor_volume};
        $(a_monitor_volume).animate(
            {volume: this.monitor_set_volume},
            {
                duration:100,
                step: (now, tween) => {
                    this.set_monitor_volume(now);
                },
            }
        )
    }
}
